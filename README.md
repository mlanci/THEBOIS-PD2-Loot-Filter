# üõí PD2 Shopper Bot (Kryszard's base filter)

A Discord bot that helps players collaboratively manage a shared **Project Diablo 2 (PD2) shopping list**, backed by GitHub as the source of truth.

This project is intentionally lightweight and transparent. It is designed to be useful first, and robust over time as edge cases are discovered and addressed.

---
## How to set up your launcher to sync to this filter.
- Browse to your PorjectD2 repository (mine is C:\Diablo II\ProjectD2)
- Open AppData folder
- Open launcherSettings.json
- Look for "Pd2AuthorList"
- Scroll down the list of "StorageAuthorList" to you reach "PiLLLa Filter"
- At the end of Pilla Filter "}" add a "," and add this
```json
{
  "name": "BAGEL BOIS",
  "url": "https://api.github.com/repos/mlanci/THEBOIS-PD2-Loot-Filter/contents",
  "author": "BAGEL BOIS"
}
```

So the full StorageAuthorList will look like this
```json
  {
        "name": "Wolfie's PD2 Loot Filters",
        "url": "https://api.github.com/repos/WolfieeifloW/pd2filter/contents",
        "author": "Wolfie"
      },
      {
        "name": "Kryszard's PD2 Loot Filter",
        "url": "https://api.github.com/repos/Kryszard-POD/Kryszard-s-PD2-Loot-Filter/contents",
        "author": "Kryszard"
      },
      {
        "name": "Kassahi's PD2 Filter",
        "url": "https://api.github.com/repos/KassahiPD2/Kassahi/contents",
        "author": "Kassahi"
      },
      {
        "name": "eqN's PD2 Filters",
        "url": "https://api.github.com/repos/eqNj/eqN-PD2-Filter/contents",
        "author": "eqN"
      },
      {
        "name": "Erazure's PD2 Loot Filter",
        "url": "https://api.github.com/repos/FiltersBy-Erazure/PD2-Loot-Filter/contents",
        "author": "Erazure"
      },
      {
        "name": "HiimFilter by Maaaark + HiimDave",
        "url": "https://api.github.com/repos/Maaaaaarrk/HiimFilter-PD2-Filter/contents",
        "author": "HiimFilter"
      },
      {
        "name": "DarkHumility + ADev Filter",
        "url": "https://api.github.com/repos/DarkHumility/DHFilter/contents",
        "author": "ADevDH"
      },
      {
        "name": "Dauracul's PD2 Loot Filter",
        "url": "https://api.github.com/repos/Dauracul/filter/contents",
        "author": "Dauracul"
      },
      {
        "name": "Sven's Filter",
        "url": "https://api.github.com/repos/StandInTheRiver/Sven-s-Filter/contents",
        "author": "Sven"
      },
      {
        "name": "PiLLLa Filter",
        "url": "https://api.github.com/repos/PiLLLaa/pd2/contents",
        "author": "PiLLLa"
      },
      {
        "name": "BAGEL BOIS",
        "url": "https://api.github.com/repos/mlanci/THEBOIS-PD2-Loot-Filter/contents",
        "author": "BAGEL BOIS"
      }
```


## ‚úÖ What Works Today

### Slash Commands

#### /shopper request \<text\>

Allows users to add (or remove) items from the shared shopping list using natural language.

Examples:
- request Nightwing's Veil  
- request eth Titan's Grip  
- request remove Stormshield  

What happens when you run this command:
1. Your request is parsed to determine intent.
2. Item names are normalized against known PD2 items.
3. The shopping list is updated in GitHub.
4. A confirmation message is sent back to Discord.

---

#### /shopper list

Displays the full shopping list for all users.

- Requires no arguments
- Shows items grouped by user
- Data is loaded directly from the GitHub-backed shopping list

---

## üì¶ Data Storage

The canonical shopping list is stored in GitHub as a JSON file (shopping_list.json)

Structure:
- One top-level key per Discord user
- Each user has a list of requested items
- Items are deduplicated per user by item code and ethereal status

This file is the single source of truth for the system.

---

## üîß Automatic Filter Updates

When items are added or removed, the bot updates only a specific section inside the item filter file.

Only the content between the autogenerated markers is modified. Everything else in the file remains unchanged.

This ensures manual edits outside of the shopping list section are preserved.

Marker:
SHOPPING LIST (AUTO-GENERATED) START
SHOPPING LIST (AUTO-GENERATED) END


---

## ‚ö†Ô∏è Known Limitations and Caveats

This section is intentionally explicit so users understand current constraints.

> IT CANNOT SUPPORT ADDING MULTIPLE ITEMS IN ONE REQUEST MESSAGE.
---

### Duplicate Entries May Occur

Although the system attempts to deduplicate items per user, duplicates may still happen in certain situations:
- Requests sent very close together
- Concurrent updates to the GitHub file
- Retry or failure during an update
- If users request the same item, it is not tested what will happen.. likely whoever requested first will win since it's above in the item.filter.

If this happens, manual cleanup may be required.

The system is not yet concurrency-safe.

---

### No Role or Permission Enforcement

At present:
- Any user can add or remove items
- There are no role-based restrictions
- Items are not locked to request owners

This may be restricted in the future.

---

### Natural Language Parsing Is Best Effort

The request parser performs best when item names closely match known PD2 names.

It may struggle with:
- Slang or abbreviations
- Misspellings
- Very ambiguous references

Unrecognized items will not be added to the shopping list.

---

### List Format Is Still Evolving

The shopping list format is stable for now but may evolve.

Future changes may include:
- Per-item notes
- Priority or urgency flags
- Timestamps
- Found or fulfilled status

---

## ‚ùå Not Implemented Yet

The following features are not currently available:
- Removal of items
- Confirmation prompts
- Found or fulfilled item tracking
- Atomic GitHub writes
- Guaranteed concurrency safety

---

## üß† High-Level Workflow

At a high level, the system operates as follows:
- Discord sends the command to the bot gateway
- The gateway validates the request
- The request is forwarded to the automation flow
- Items are parsed and normalized
- The shopping list in GitHub is read and updated
- A follow-up message is sent back to Discord

GitHub acts as the persistent source of state.

---

## üí° Design Philosophy

This project favors clarity and recoverability:
- Changes should be transparent
- Failures should be visible
- Data should be easy to inspect and fix manually
- The bot should never silently discard user intent

---

## üôã Frequently Asked Questions

Can two users add items at the same time  
Yes, but duplicate entries may occur in rare cases

Does the list command show only my items  
No, it shows the combined list for all users

Can I remove someone else‚Äôs request  
Currently yes

---

## üöß Roadmap (Short-Term)

Planned improvements include:
- Stronger deduplication rules - if duplication then two users want the same item - lets make it fun and figure something out to put on the title or announcement when it drops.
- Safer update handling
- Per-user list views
- Found item tracking
- Better error reporting
- Remove items from list

---

This project is actively evolving. Expect improvements as usage grows.
